<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <style>
        /* ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        :root {
            --primary-color: #007bff;
            --danger-color: #dc3545;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            padding-bottom: 80px; /* ä¸‹éƒ¨ã®ä½™ç™½ï¼ˆFABç”¨ï¼‰ */
        }

        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin: 15px 0;
            color: #444;
        }

        /* ã‚«ãƒ¼ãƒ‰å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 15px;
            margin-bottom: 15px;
        }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-size: 16px; /* ã‚¹ãƒãƒ›ã§ã‚ºãƒ¼ãƒ é˜²æ­¢ */
            appearance: none; /* iOSã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«è§£é™¤ */
        }

        .row {
            display: flex;
            gap: 10px;
        }
        
        .row > * {
            flex: 1;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            transition: opacity 0.2s;
        }

        .btn:active {
            opacity: 0.8;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            width: 100%;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
            padding: 8px 12px;
            font-size: 0.9rem;
            width: auto;
        }

        /* ãƒ•ã‚£ãƒ«ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .filter-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ */
        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .task-item {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            margin-bottom: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-left: 6px solid transparent;
        }

        .task-content {
            flex-grow: 1;
            margin-right: 10px;
        }

        .task-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }

        .task-meta {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background-color: #eee;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* å„ªå…ˆåº¦ã‚«ãƒ©ãƒ¼ */
        .priority-high { border-left-color: #dc3545; }
        .priority-medium { border-left-color: #ffc107; }
        .priority-low { border-left-color: #28a745; }

        /* ã‚¹ãƒ†ã‚£ãƒƒã‚­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼çš„ã«ä½¿ã†å ´åˆãªã©ã«å‚™ãˆã¦ */
        .app-header {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ã‚¿ã‚¹ã‚¯ç®¡ç†</h1>

        <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚¨ãƒªã‚¢ -->
        <div class="card input-group">
            <input type="text" id="taskTitle" class="form-control" placeholder="ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›..." required>
            
            <input type="text" id="taskCategory" class="form-control" list="categoryList" placeholder="ã‚«ãƒ†ã‚´ãƒª (ä¾‹: ä»•äº‹)">
            <datalist id="categoryList">
                <!-- JSã§å‹•çš„ã«è¿½åŠ  -->
            </datalist>

            <div class="row">
                <select id="taskPriority" class="form-control">
                    <option value="3">å„ªå…ˆåº¦: é«˜</option>
                    <option value="2" selected>å„ªå…ˆåº¦: ä¸­</option>
                    <option value="1">å„ªå…ˆåº¦: ä½</option>
                </select>
                <input type="date" id="taskDeadline" class="form-control">
            </div>

            <button class="btn btn-primary" onclick="addTask()">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
        </div>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° -->
        <div class="filter-section" style="margin-bottom: 15px;">
            <select id="filterCategory" class="form-control" onchange="renderTasks()">
                <option value="all">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
                <!-- JSã§å‹•çš„ã«è¿½åŠ  -->
            </select>
        </div>

        <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
        <ul id="taskList" class="task-list">
            <!-- JSã§ã‚¿ã‚¹ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </ul>
    </div>

    <script>
        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
        const STORAGE_KEY_TASKS = 'todoApp_tasks';
        const STORAGE_KEY_CATEGORIES = 'todoApp_categories';

        // çŠ¶æ…‹ç®¡ç†
        let tasks = [];
        let categories = new Set(['ä»•äº‹', 'ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ', 'è²·ã„ç‰©']);

        // åˆæœŸåŒ–å‡¦ç†
        window.onload = () => {
            loadData();
            updateCategoryOptions();
            renderTasks();
        };

        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°
        function loadData() {
            const savedTasks = localStorage.getItem(STORAGE_KEY_TASKS);
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }

            const savedCategories = localStorage.getItem(STORAGE_KEY_CATEGORIES);
            if (savedCategories) {
                // é…åˆ—ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã®ã§Setã«æˆ»ã™
                categories = new Set(JSON.parse(savedCategories));
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
        function saveData() {
            localStorage.setItem(STORAGE_KEY_TASKS, JSON.stringify(tasks));
            // Setã¯ç›´æ¥JSONåŒ–ã§ããªã„ã®ã§é…åˆ—ã«å¤‰æ›
            localStorage.setItem(STORAGE_KEY_CATEGORIES, JSON.stringify([...categories]));
        }

        // ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
        function addTask() {
            const titleInput = document.getElementById('taskTitle');
            const categoryInput = document.getElementById('taskCategory');
            const priorityInput = document.getElementById('taskPriority');
            const deadlineInput = document.getElementById('taskDeadline');

            const title = titleInput.value.trim();
            const category = categoryInput.value.trim() || 'æœªåˆ†é¡';
            const priority = parseInt(priorityInput.value);
            const deadline = deadlineInput.value;

            if (!title) {
                alert('ã‚¿ã‚¹ã‚¯å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const newTask = {
                id: Date.now(),
                title: title,
                category: category,
                priority: priority,
                deadline: deadline
            };

            tasks.push(newTask);
            
            // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªãªã‚‰è¿½åŠ 
            if (!categories.has(category)) {
                categories.add(category);
                updateCategoryOptions();
            }

            // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            saveData();

            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            titleInput.value = '';
            categoryInput.value = '';
            deadlineInput.value = ''; // æ—¥ä»˜ã‚¯ãƒªã‚¢
            priorityInput.value = '2'; // å„ªå…ˆåº¦ã‚’ä¸­ã«æˆ»ã™

            renderTasks();
        }

        // ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã™ã‚‹é–¢æ•°
        function deleteTask(id) {
            if(confirm('å®Œäº†ã¨ã—ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                tasks = tasks.filter(task => task.id !== id);
                saveData(); // ä¿å­˜
                renderTasks();
            }
        }

        // ã‚«ãƒ†ã‚´ãƒªã®é¸æŠè‚¢ï¼ˆå…¥åŠ›å±¥æ­´ã¨ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateCategoryOptions() {
            const list = document.getElementById('categoryList');
            const filter = document.getElementById('filterCategory');
            
            const currentFilter = filter.value;

            list.innerHTML = '';
            // ãƒ•ã‚£ãƒ«ã‚¿ã®ã€Œã™ã¹ã¦ã€ä»¥å¤–ã‚’ä¸€æ—¦ã‚¯ãƒªã‚¢
            while (filter.options.length > 1) {
                filter.remove(1);
            }

            categories.forEach(cat => {
                // å…¥åŠ›å€™è£œ
                const option = document.createElement('option');
                option.value = cat;
                list.appendChild(option);

                // ãƒ•ã‚£ãƒ«ã‚¿
                const filterOption = document.createElement('option');
                filterOption.value = cat;
                filterOption.textContent = cat;
                filter.appendChild(filterOption);
            });

            filter.value = currentFilter;
        }

        function getPriorityText(level) {
            if (level === 3) return 'é«˜';
            if (level === 2) return 'ä¸­';
            return 'ä½';
        }

        function getPriorityClass(level) {
            if (level === 3) return 'priority-high';
            if (level === 2) return 'priority-medium';
            return 'priority-low';
        }

        // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç”¨ï¼ˆç°¡å˜åŒ–ï¼‰
        function formatDate(dateString) {
            if (!dateString) return 'ãªã—';
            const date = new Date(dateString);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        function renderTasks() {
            const listContainer = document.getElementById('taskList');
            const filterValue = document.getElementById('filterCategory').value;

            listContainer.innerHTML = '';

            // 1. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            let filteredTasks = tasks.filter(task => {
                if (filterValue === 'all') return true;
                return task.category === filterValue;
            });

            // 2. ã‚½ãƒ¼ãƒˆï¼ˆå„ªå…ˆåº¦ãŒé«˜ã„é † â†’ ç· ã‚åˆ‡ã‚ŠãŒè¿‘ã„é †ï¼‰
            filteredTasks.sort((a, b) => {
                if (b.priority !== a.priority) {
                    return b.priority - a.priority;
                }
                if (!a.deadline) return 1;
                if (!b.deadline) return -1;
                return new Date(a.deadline) - new Date(b.deadline);
            });

            // 3. è¡¨ç¤ºç”Ÿæˆ
            if (filteredTasks.length === 0) {
                listContainer.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            filteredTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `task-item ${getPriorityClass(task.priority)}`;
                
                li.innerHTML = `
                    <div class="task-content">
                        <span class="task-title">${task.title}</span>
                        <div class="task-meta">
                            <span class="tag">${task.category}</span>
                            <span>å„ªå…ˆåº¦: ${getPriorityText(task.priority)}</span>
                            ${task.deadline ? `<span>ğŸ“… ${formatDate(task.deadline)}</span>` : ''}
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteTask(${task.id})">å‰Šé™¤</button>
                `;
                listContainer.appendChild(li);
            });
        }
    </script>
</body>
</html>